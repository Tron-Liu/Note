# 第一章 TCP/IP协议族

## 1.1 TCP/IP协议族体系结构以及主要协议

### 1.1.1 数据链路层

数据链路层实现了网卡接口的网络驱动程序，以处理数据在物理媒介（比如以太网、令牌环）上的传输

1. 数据链路层两个常用的协议是 `ARP` 协议（Address Resolve Protocol，地址解析协议）和 `RARP` 协议（Reverse Address Resolve Protocol，逆地址解析协议）。它们实现了 IP 地址和机器物理地址之间的相互转换
2. 网络层使用 IP 地址寻址一台机器，而数据链路层使用物理地址寻址一台机器

### 1.1.2 网络层

网络层实现数据包的选路和转发

1. 网络层最核心的协议是 IP 协议 （Internet Protocol）。IP 协议根据数据包的目的 IP 地址来决定如何投递它
2. 网络层另外一个重要的协议是 ICMP 协议（Internet Control Message Protocol, 因特网控制报文协议）。它是 IP 协议的重要补充，主要用于检测网络连接

### 1.1.3 传输层

传输层为两台主机的应用程序提供端到端的通信，它负责数据的收发，链路的超时重连等。传输层协议主要有三个：TCP 协议、UDP 协议和 SCTP 协议

1. TCP 协议（Transmission Control Protocol，传输控制协议）为应用层提供可靠的、面向连接的和基于流（stream）的服务。
   * 可靠的：TCP 协议使用超时重传、数据确认等方式来确保数据包被正确地发送至目的端
   * 面向连接：使用 TCP 协议通信的双方必须先建立 TCP 连接，并在内核中为该连接维持一些必要的数据结构，比如连接的状态、读写缓冲区，以及诸多定时器等。当通信结束时，双方必须关闭连接以释放这些内核数据
   * 基于流的：基于流的数据没有边界限制，它源源不断地从通信的一端流入另一端。发送端可以逐个字节地向数据流中写入数据，接受端也可以逐个字节地将它们读出
2. UDP 协议（User Datagram Protocol，用户数据报协议）为应用层提供不可靠、无连接和基于数据报的服务。
   * 不可靠：不可靠意味着 UDP 协议无法保证数据从发送端正确地传送到目的端
   * 无连接：通信双方不保持一个长久的联系，因此应用程序每次发送数据都要明确指定接受端的地址
   * 基于数据报：每个 UDP 数据报都有一个长度，接受端必须以该长度为最小单位将其所有内容一次性读出，否则数据将被截断

### 1.1.4 应用层

应用层负责处理应用程序的逻辑

## 1.2 封装

1. 经过 TCP/UDP/UP 封装后的数据称为 TCP/UDP/UP 报文段（TCP/UDP/UP message segment）
2. 经过数据链路层封装的数据称为帧（frame）。传输媒介不同，帧的类型也不同。比如，以太网上传输的是以太网帧（ethernet frame），而令牌环网络上传输的则是令牌环帧（token ring frame）
   * 帧的最大传输单元（Max Transmit Unit，MTU），即帧最多能携带多少上层协议数据，通常受到网络类型的限制。正因为如此，过长的 IP 数据报可能需要被分片（fragment）传输
   * 帧才是最终在物理网络上传送的字节序列

## 1.3 分用

当帧到达目的主机时，将沿着协议栈自底向上依次传递。各层协议依此处理帧中本层负责的头部数据，以获取所需的信息，并最终将处理后的帧交给目标应用程序。这个过程称为分用（demultiplexing）

   1. 分用是依靠头部信息中的类型字段实现的
