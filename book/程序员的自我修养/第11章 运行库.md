# 第 11 章 运行库

## 11.1 入口函数和程序初始化

### 11.1.1 程序从 main 开始吗

1. 所有这些事实都在为 "main 创论" 提供不利的证据：操作系统装载程序之后，首先运行的代码并不是 main 的第一行，而是某些别的代码，这些代码负责准备好 main 函数执行所需要的环境，并且负责调用 main 函数，这时候你才可以在 main 函数里放心大胆地写各种代码：申请内存、使用系统调用、触发异常、访问 I/O。在 main 返回之后，它会记录 main 函数地返回值，调用 atexit 注册地函数，然后结束进程。运行这些代码的函数称为 **入口函数** 或 **入口点 (Entry Point)**。
2. 程序的入口点实际上是一个程序的初始化和结束部分，它往往是运行库的一部分。一个典型的程序运行步骤大致如下：
   - 操作系统在创建进程后，把控制权交到了程序的入口，这个入口往往是运行库中的某个入口函数。
   - 入口函数对运行库和程序运行环境进行初始化，包括堆、I/O、线程、全局变量构造，等等。
   - 入口函数在完成初始化之后，调用 main 函数，正式开始执行程序主体部分。
   - main 函数执行完毕以后，返回到入口函数，入口函数进行清理工作，包括全部变量析构、堆销毁、关闭 I/O 等，然后进行系统调用结束进程。

### 11.1.3 运行库与 I/O

### 11.1.4 MSVC CRT 的入口函数初始化

> **系统堆初始化**
>
> 1. MSVC 的堆初始化由函数 _heap_init 完成
>
> **I/O 初始化**

### 11.2.3 C 语言标准库

1. 变长参数
   - va_list 实际是一个指针
   - va_start 将 va_list 定义的指针指向函数的最后一个参数后面的位置
   - va_arg

### 11.2.3 glibc 与 MSVC CRT
